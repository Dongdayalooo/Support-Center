<!-- Loading... -->
<div class="loading-indicator" *ngIf="loading">
  <p-progressSpinner [style]="{width: '50px', height: '50px'}" strokeWidth="8" fill="#EEEEEE" animationDuration=".5s">
  </p-progressSpinner>
</div>
<!-- Message Response... -->
<p-toast position="bottom-right"></p-toast>
<!-- Confirm... -->
<p-confirmDialog header="Xác nhận" icon="pi pi-exclamation-triangle" acceptLabel="Chấp nhận" rejectLabel="Không">
</p-confirmDialog>

<div class="detail-vendor">
  <div class="row no-margin" id="parent">
    <div class="col-md-12 header" style="padding: 6px;" [ngClass]="{'fixed': fixed}" [ngStyle]="{'width':withFiexd}">
      <div class="row">
        <div class="col-md-6 no-padding">
          <div class="row no-margin">
            <div class="col-md-1 col-sm-1 col-xs-3">
              <div class="header-box-icon">
                <img src="/assets/icons/components/create_lead.svg" class="header-icon">
              </div>
            </div>
            <div class="col-md-11 col-sm-10 col-xs-9">
              <div style="display: flex; flex-direction: column; margin-top: -6px;">
                <span class="vendor-name" pTooltip="{{vendorModel.vendorName}}"
                  tooltipPosition="bottom">{{vendorModel.vendorName}}</span>
                <span class="vendor-group-name">{{vendorModel.vendorGroupName}}</span>
              </div>
              <div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-12 display-item" style="  justify-content: flex-end; margin-top: 5px;">
              <button type="button" class="btn-remove">
                <span (click)="goBackToList()" class="btn-remove-text">Thoát</span>
              </button>

              <button (click)="editVendorInfor()" *ngIf="actionEdit" type="button" class="btn-save">
                <span class="btn-save-text">Lưu</span>
              </button>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row no-margin infor-vendor-wrapper mt-10">
    <div class="col-md-7">



      <div class="col-md-4">
        <div class="box1 text-center">
          <span>Tổng doanh thu (VND)</span>
          <div class="mt-10 money">{{ vendorModel.tongDoanhThu | number}}</div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="box2 text-center">
          <span> Doanh thu trong tháng (VND)</span>
          <div class="mt-10 money">{{ vendorModel.doanhThuTrongThang | number}}</div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="box3 text-center">
          <span> Công nợ còn phải trả (VND)</span>
          <div class="mt-10 money">{{ vendorModel.congNoConPhaiTra | number}}</div>
        </div>
      </div>

      <div class="col-md-4 mt-10">
        <div class="box1 text-center">
          <span>Tổng hoa hồng (VND)</span>
          <div class="mt-10 money">{{ vendorModel.tongHoaHong | number}}</div>
        </div>
      </div>

      <div class="col-md-4 mt-10">
        <div class="box2 text-center">
          <span>Hoa hồng trong tháng (VND)</span>
          <div class="mt-10 money">{{ vendorModel.hoaHongTrongThang | number}}</div>
        </div>
      </div>

      <div class="col-md-4 mt-10">
        <div class="box3 text-center">
          <span>Công nợ còn phải thu (VND)</span>
          <div class="mt-10 money">{{ vendorModel.congNoConPhaiThu | number}}</div>
        </div>
      </div>
    </div>

    <div class="col-md-5" style="padding: 20px;">
      <div class="col-md-4 text-center">
        <div style="font-size: 40px;font-weight: bold;">{{trungBinh | number:'1.2-2'}}</div>
        <p-rating [(ngModel)]="start" readonly="true" [cancel]="false"></p-rating>
        <div class="mt-10">{{(tongBaiDanhGia |number) + " bài đánh giá"}} </div>
      </div>
      <div class="col-md-8">
        <div class="col-md-1">
          <span class="row no-margin mt-10" style="line-height: 15px;">5</span>
          <span class="row no-margin mt-10" style="line-height: 15px;">4</span>
          <span class="row no-margin mt-10" style="line-height: 15px;">3</span>
          <span class="row no-margin mt-10" style="line-height: 15px;">2</span>
          <span class="row no-margin mt-10" style="line-height: 15px;">1</span>
        </div>
        <div class="col-md-11">
          <p-progressBar [value]="fiveStart" [showValue]="false"
            [ngStyle]="{ 'margin-top': '10px!important'}"></p-progressBar>

          <p-progressBar [value]="fourtStart" [showValue]="false"
            [ngStyle]="{ 'margin-top': '10px!important'}"></p-progressBar>

          <p-progressBar [value]="threeStart" [showValue]="false"
            [ngStyle]="{ 'margin-top': '10px!important'}"></p-progressBar>

          <p-progressBar [value]="twoStart" [showValue]="false"
            [ngStyle]="{ 'margin-top': '10px!important'}"></p-progressBar>

          <p-progressBar [value]="oneStart" [showValue]="false"
            [ngStyle]="{ 'margin-top': '10px!important'}"></p-progressBar>
        </div>
      </div>
    </div>
  </div>



  <div class="row no-margin infor-vendor-wrapper mt-10">
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-12 no-padding">
          <p-accordion expandIcon="pi pi-fw pi-chevron-circle-right" collapseIcon="pi pi-fw pi-chevron-circle-down"
            class="w-100">
            <p-accordionTab header="Thông tin nhà cung cấp" [selected]="true">
              <div class="row display-item">
                <form [formGroup]="editVendorForm" class="w-100">
                  <div class="col-md-12">
                    <div class="row buffer-bottom">
                      <div class="col-md-4">
                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Nhóm nhà cung cấp</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="VendorGroup"
                              [styleClass]="(editVendorForm.get('VendorGroup').invalid && (editVendorForm.get('VendorGroup').dirty || editVendorForm.get('VendorGroup').touched)) ? 'error-border' : ''"
                              [filter]="true" [showClear]="true" [resetFilterOnHide]="true" [options]="listVendorGroup"
                              optionLabel="categoryName" placeholder="Chọn nhóm nhà cung cấp" [showClear]="true"
                              [style]="{'width': '100%'}"></p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span
                              [hidden]="editVendorForm.get('VendorGroup').valid || editVendorForm.get('VendorGroup').untouched"
                              *ngIf="editVendorForm.get('VendorGroup').hasError('required')" class="error-message-span">
                              Chọn nhóm nhà cung cấp</span>
                          </div>

                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Mã nhà cung cấp</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="VendorCode" type="text" maxlength="10"
                              [ngClass]="(editVendorForm.get('VendorCode').invalid && (editVendorForm.get('VendorCode').dirty || editVendorForm.get('VendorCode').touched)) ? 'error-border' : ''"
                              class="w100" pInputText placeholder="Tối đa 10 ký tự" />
                          </div>
                          <div class="col-md-12"
                            [hidden]="editVendorForm.get('VendorCode').valid || editVendorForm.get('VendorCode').untouched">
                            <span
                              *ngIf="editVendorForm.get('VendorCode').hasError('required') || editVendorForm.get('VendorCode').hasError('blankString') "
                              class="error-message-span">Không được
                              để trống</span>
                            <span *ngIf="editVendorForm.get('VendorCode').hasError('duplicateCode')"
                              class="error-message-span">Mã nhà cung cấp đã tồn tại trong hệ thống</span>
                          </div>
                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Tên nhà cung cấp</span><span class="required">*</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="VendorName" type="text" maxlength="250"
                              [ngClass]="(editVendorForm.get('VendorName').invalid && (editVendorForm.get('VendorName').dirty || editVendorForm.get('VendorName').touched)) ? 'error-border' : ''"
                              class="w100" pInputText placeholder="" />
                          </div>
                          <div class="col-md-12"
                            [hidden]="editVendorForm.get('VendorName').valid || editVendorForm.get('VendorName').untouched">
                            <span
                              *ngIf="editVendorForm.get('VendorName').hasError('required') || editVendorForm.get('VendorName').hasError('blankString') "
                              class="error-message-span">
                              Nhập tên nhà cung cấp</span>
                          </div>
                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Địa chỉ</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="Address" type="text" maxlength="250"
                              [ngClass]="(editVendorForm.get('Address').invalid && (editVendorForm.get('Address').dirty || editVendorForm.get('Address').touched)) ? 'error-border' : ''"
                              class="w100" pInputText placeholder="Số nhà, đường..." />
                          </div>
                          <div class="col-md-12"
                            [hidden]="editVendorForm.get('Address').valid || editVendorForm.get('Address').untouched">
                          </div>
                        </div>

                      </div>

                      <div class="col-md-4">

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Email</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="Email" type="text" maxlength="100"
                              [ngClass]="(editVendorForm.get('Email').invalid && (editVendorForm.get('Email').dirty || editVendorForm.get('Email').touched)) ? 'error-border' : ''"
                              class="w100" pInputText placeholder="" />
                          </div>
                          <div class="col-md-12"
                            [hidden]="editVendorForm.get('Email').valid || editVendorForm.get('Email').untouched">
                            <span *ngIf="editVendorForm.get('Email').hasError('pattern')" class="error-message-span">
                              Sai định dạng Email</span>
                          </div>
                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Số điện thoại</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="Phone" type="text" maxlength="32"
                              [ngClass]="(editVendorForm.get('Phone').invalid && (editVendorForm.get('Phone').dirty || editVendorForm.get('Phone').touched)) ? 'error-border' : ''"
                              class="w100" pInputText placeholder="" />
                          </div>
                          <div class="col-md-12"
                            [hidden]="editVendorForm.get('Phone').valid || editVendorForm.get('Phone').untouched">
                            <span *ngIf="editVendorForm.get('Phone').hasError('required')" class="error-message-span">
                              Sđt không được để trống!</span>
                          </div>
                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Website</span>
                          </div>
                          <div class="col-md-12">
                            <input formControlName="Link" type="text" maxlength="250"
                              [ngClass]="(editVendorForm.get('Link').invalid && (editVendorForm.get('Link').dirty || editVendorForm.get('Link').touched)) ? 'error-border' : ''"
                              class="w100" pInputText placeholder="" />
                          </div>
                          <div class="col-md-12"
                            [hidden]="editVendorForm.get('Link').valid || editVendorForm.get('Link').untouched">
                          </div>
                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Đơn giá</span>
                          </div>
                          <div class="col-md-12">
                            <input type="text" [(ngModel)]="vendorPrice" min="0" class="w100" pInputText
                              [cleave]="{numeral: true, numeralPositiveOnly: true}" placeholder="Nhập đơn giá"
                              [ngModelOptions]="{standalone: true}" />
                          </div>
                        </div>

                      </div>

                      <div class="col-md-4">
                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Tỉnh/Thành phố</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="Province" (onChange)="changeProvince($event)"
                              [styleClass]="(editVendorForm.get('Province').invalid && (editVendorForm.get('Province').dirty || editVendorForm.get('Province').touched)) ? 'error-border' : ''"
                              [filter]="true" [showClear]="true" [resetFilterOnHide]="true" [options]="listProvince"
                              optionLabel="provinceName" placeholder="Chọn tỉnh/thành phố" [showClear]="true"
                              [style]="{'width': '100%'}"></p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span
                              [hidden]="editVendorForm.get('Province').valid || editVendorForm.get('Province').untouched"
                              *ngIf="editVendorForm.get('Province').hasError('required')" class="error-message-span">
                              Chọn tỉnh/thành phố</span>
                          </div>
                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Quận/Huyện</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="District" (onChange)="changeDistrict($event)"
                              [styleClass]="(editVendorForm.get('District').invalid && (editVendorForm.get('District').dirty || editVendorForm.get('District').touched)) ? 'error-border' : ''"
                              [filter]="true" [showClear]="true" [resetFilterOnHide]="true"
                              [options]="listCurrentDistrict" optionLabel="districtName" placeholder="Chọn quận/huyện"
                              [showClear]="true" [style]="{'width': '100%'}"></p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span
                              [hidden]="editVendorForm.get('District').valid || editVendorForm.get('District').untouched"
                              *ngIf="editVendorForm.get('District').hasError('required')" class="error-message-span">
                              Chọn quận/huyện</span>
                          </div>
                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Phường/Xã</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown formControlName="Ward"
                              [styleClass]="(editVendorForm.get('Ward').invalid && (editVendorForm.get('Ward').dirty || editVendorForm.get('Ward').touched)) ? 'error-border' : ''"
                              [filter]="true" [showClear]="true" [resetFilterOnHide]="true" [options]="listCurrentWard"
                              optionLabel="wardName" placeholder="Chọn phường/xã" [showClear]="true"
                              [style]="{'width': '100%'}"></p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span [hidden]="editVendorForm.get('Ward').valid || editVendorForm.get('Ward').untouched"
                              *ngIf="editVendorForm.get('Ward').hasError('required')" class="error-message-span">
                              Chọn phường/xã</span>
                          </div>
                        </div>

                        <div class="row buffer-bottom">
                          <div class="col-md-12 buffer-bottom-label">
                            <span>Trạng thái <span class="required">*</span>:</span>
                          </div>
                          <div class="col-md-12">
                            <p-dropdown [options]="listTrangThai" formControlName="TrangThai" [filter]="true"
                              [resetFilterOnHide]="true" placeholder="Chọn trạng thái" optionLabel="text"
                              [style]="{'width': '100%'}"
                              [styleClass]="(editVendorForm.get('TrangThai').invalid && (editVendorForm.get('TrangThai').dirty || editVendorForm.get('TrangThai').touched)) ? 'error-border' : ''">
                            </p-dropdown>
                          </div>
                          <div class="col-md-12">
                            <span
                              [hidden]="editVendorForm.get('TrangThai').valid || editVendorForm.get('TrangThai').untouched"
                              *ngIf="editVendorForm.get('TrangThai').hasError('required')" class="error-message-span">
                              Chọn trạng thái</span>
                          </div>

                        </div>
                      </div>


                    </div>

                  </div>

                </form>
              </div>

            </p-accordionTab>
          </p-accordion>
        </div>

      </div>
    </div>
  </div>

  <div class="row no-margin infor-vendor-wrapper mt-10">
    <div class="col-md-12">
      <p-tabView>

        <p-tabPanel header="Danh sách dịch vụ">
          <div class="row">
            <div class="col-md-12 mt-10 text-end">
              <input type="text" class="iput-text" [(ngModel)]="filterGlobar1" placeholder="Tìm kiếm trong danh sách"
                (input)="myTable1.filterGlobal($event.target.value.trim(), 'contains')">
            </div>
            <div class="col-md-12 mt-10">
              <p-table #myTable1 [columns]="cols1" [value]="listDv" [paginator]="true" [rows]="10">
                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th *ngFor="let col of columns" pResizableColumn [pSortableColumn]="col.field"
                      [ngStyle]="{ 'text-align': 'center', display: col.display, width: col.width }">
                      {{col.header}}

                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns" let-index="rowIndex">
                  <tr>
                    <td *ngFor="let col of columns" [ngSwitch]="col.field"
                      [ngStyle]="{ 'text-align': col.textAlign, display: col.display, width: col.width }">

                      <span *ngSwitchCase="'stt'">
                        {{index + 1}}
                      </span>

                      <span *ngSwitchCase="'price'">
                        {{rowData["price"] | number: 0}}
                      </span>

                      <span *ngSwitchCase="'soLuongToiThieu'">
                        {{rowData["soLuongToiThieu"] | number: 0}}
                      </span>

                      <span *ngSwitchCase="'prepaymentValue'">
                        {{rowData["giaTriThanhToan"]  ? ((rowData["giaTriThanhToan"] | number: 0) +
                        (rowData["yeuCauThanhToan"] == 1 ? "%" : "" )) : ""}}
                      </span>

                      <span *ngSwitchCase="'giaTriChietKhau'">
                        {{rowData["chietKhauId"] == 1 ? ((rowData["giaTriChietKhau"] | number: 0) + "%") :
                        (rowData["giaTriChietKhau"]| number: 0)}}
                      </span>

                      <span *ngSwitchCase="'mucHoaHong'">
                        <b *ngFor="let data of rowData['listCauHinhHoaHong']">
                          {{data.loaiHoaHong == 1 ? (data.giaTriHoaHong + "% ,") : (data.giaTriHoaHong != null ?
                          (data.giaTriHoaHong | number: 0) + ', ' : "") }}
                        </b>
                      </span>

                      <span *ngSwitchCase="'efftiveDate'">
                        {{(rowData["thoiGianTu"] != null ? (rowData["thoiGianTu"] | date: "dd/MM/yyyy") : "") + "
                        - " + (rowData["thoiGianDen"]!= null ? (rowData["thoiGianDen"] | date:
                        "dd/MM/yyyy") : "")}}
                      </span>

                      <span *ngSwitchDefault>
                        {{ rowData[col.field] }}
                      </span>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </p-tabPanel>

        <p-tabPanel header="Danh sách đơn hàng">
          <div class="row">
            <div class="col-md-12 mt-10 text-end">
              <input type="text" class="iput-text" [(ngModel)]="filterGlobar2" placeholder="Tìm kiếm trong danh sách"
                (input)="myTable2.filterGlobal($event.target.value.trim(), 'contains')">
            </div>
            <div class="col-md-12 mt-10">
              <p-table #myTable2 [columns]="cols2" [value]="listDonHang" [paginator]="true" [rows]="10">
                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th *ngFor="let col of columns" pResizableColumn [pSortableColumn]="col.field"
                      [ngStyle]="{ 'text-align': 'center', display: col.display, width: col.width }">
                      <span class="ui-column-title">{{col.header}}</span>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns" let-index="rowIndex">
                  <tr>
                    <td *ngFor="let col of columns" [ngSwitch]="col.field"
                      [ngStyle]="{ 'text-align': col.textAlign, display: col.display, width: col.width }">

                      <span *ngSwitchCase="'stt'">
                        {{index + 1}}
                      </span>

                      <span *ngSwitchCase="'vendorOrderCode'" class="link"
                        (click)="goToVenderOrderDetail(rowData)"
                        style="display: inline-block; padding: 2px 2px;">
                        {{ rowData[col.field] }}
                      </span>

                      <span *ngSwitchCase="'vendorOrderType'">
                        {{rowData["vendorOrderType"] == 1 ? "KTNN thanh toán" : "KH thanh toán"}}
                      </span>

                      <span *ngSwitchCase="'vendorOrderDate'">
                        {{rowData["vendorOrderDate"] | date: "dd/MM/yyyy"}}
                      </span>


                      <span *ngSwitchCase="'tongTienDonHang'">
                        {{rowData["tongTienDonHang"] | number: 0}}
                      </span>

                      <span *ngSwitchCase="'tongTienHoaHong'">
                        {{rowData["tongTienHoaHong"] | number: 0}}
                      </span>


                      <span *ngSwitchDefault>
                        {{ rowData[col.field] }}
                      </span>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </p-tabPanel>

        <p-tabPanel header="Danh sách đánh giá">
          <div class="row">
            <div class="col-md-12 mt-10 text-end">
              <input type="text" class="iput-text" [(ngModel)]="filterGlobar3" placeholder="Tìm kiếm trong danh sách"
                (input)="myTable3.filterGlobal($event.target.value.trim(), 'contains')">
            </div>
            <div class="col-md-12 mt-10">
              <p-table #myTable3 [columns]="cols3" [value]="listDanhGia" [paginator]="true" [rows]="10">
                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th *ngFor="let col of columns" pResizableColumn [pSortableColumn]="col.field"
                      [ngStyle]="{ 'text-align': 'center', display: col.display, width: col.width }">
                      {{col.header}}

                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns" let-index="rowIndex">
                  <tr>
                    <td *ngFor="let col of columns" [ngSwitch]="col.field"
                      [ngStyle]="{ 'text-align': col.textAlign, display: col.display, width: col.width }">


                      <span *ngSwitchCase="'stt'">
                        {{index + 1}}
                      </span>

                      <span *ngSwitchCase="'tenDichVu'" [innerHTML]="rowData[col.field]">
                      </span>

                      <span *ngSwitchCase="'orderActionCode'" class="link"
                        (click)="viewOrderAction(rowData.orderActionId)"
                        style="display: inline-block; padding: 2px 2px;">
                        {{ rowData[col.field] }}
                      </span>


                      <span *ngSwitchCase="'createdDate'">
                        {{rowData["createdDate"] | date: "dd/MM/yyyy hh:mm"}}
                      </span>

                      <span *ngSwitchDefault>
                        {{ rowData[col.field] }}
                      </span>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </p-tabPanel>

      </p-tabView>
    </div>
  </div>
</div>